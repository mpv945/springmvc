<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:batch="http://www.springframework.org/schema/batch"
       xsi:schemaLocation="
       http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- 参数校验 -->
    <bean id="validator" class="org.springframework.batch.core.job.DefaultJobParametersValidator" >
        <property name="requiredKeys" >
            <set>
                <value>date</value>
            </set>
        </property>
        <property name="optionalKeys" >
            <set>
                <value>name</value>
            </set>
        </property>
    </bean>

    <!--定义JOB作业 job的下级对象作用域目前分Step-->
    <batch:job id="chunkJob" restartable="false"><!--  restartable="false" 表示该任务不支持重启运行-->
        <batch:step id="chunkStep">
            <tasklet>
                <chunk reader="reader" writer="writer" commit-interval="10" />
            </tasklet>
        </batch:step>
        <batch:validator>
            <bean class="org.springframework.batch.core.job.DefaultJobParametersValidator">

            </bean>
        </batch:validator>
    </batch:job>
    <batch:job id="chunkBusinessJob" parent="baseJob"><!--通过继承，拥有父类特性-->
        <batch:step id="chunkBusinessStep">
            <batch:tasklet>
                <batch:chunk reader="reader" writer="writer" commit-interval="10" />
            </batch:tasklet>
        </batch:step>
        <batch:listeners merge="true"><!--表示合并父类的监听器，否则只执行自己的监听器，合并时，父类监听器排在前面-->
            <batch:listener ref="jobExecutionListener"></batch:listener>
        </batch:listeners>
    </batch:job>

    <bean id="reader" class="org.haijun.study.item.AutoReader" />
    <bean id="writer" class="org.haijun.study.item.ConsoleWriter" />
    <bean id="stopListener" class="org.haijun.study.item.StopStepListener" />

    <bean id="schedulerLauncher" class="org.haijun.study.scheduler.SchedulerLauncher">
        <property name="job" ref="helloworldJob" />
        <property name="jobLauncher" ref="jobLauncher" />
    </bean>

    <!-- 定义自定义的job任务 HelloWorld Job -->
    <batch:job id="helloworldJob">

        <batch:step id="helloworldStep">
            <batch:tasklet>
                <bean class="org.haijun.study.tasklet.HelloWorldTasklet"></bean>
            </batch:tasklet>
        </batch:step>
    </batch:job>



</beans>